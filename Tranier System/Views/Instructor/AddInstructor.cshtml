@model InstDeptVM

<h2 class="text-center mt-0">Add New Instructor</h2>
<hr class="divider" />

<form action="/Instructor/SaveAdd" method="post" enctype="multipart/form-data">
    <div>
        <label asp-for="Name"></label>
        <input asp-for="Name" class="form form-control" />
    </div>
    <div>
        <label asp-for="Address"></label>
        <input asp-for="Address" class="form form-control" />
    </div>
    <div>
        <label asp-for="Salary"></label>
        <input asp-for="Salary" class="form form-control" />
    </div>
    <div>
        <label asp-for="Image"></label>
        <input type="file" asp-for="Image" class="form form-control" />
    </div>
    <div>
        <label asp-for="DepartmentId"></label>
        <select asp-for="DepartmentId" class="form form-control" onchange="GetCrs()">
            <option value="0">--Select Department--</option>
            @foreach (var department in Model.Depts)
            {
                    @if (department.Id==Model.DepartmentId)
                    {
                        <option selected value="@department.Id">@department.Name</option>
                    }else
                    {
                        <option value="@department.Id">@department.Name</option>
                    }        
            }
        </select>
    </div>
    <div>
        <label asp-for="CourseId"></label>
        <select asp-for="CourseId" class="form form-control">
           @*  @foreach (var course in Model.Courses)
            {
                @if (course.Id == Model.CourseId)
                {
                    <option selected value="@course.Id">@course.Name</option>
                }
                else
                {
                    <option value="@course.Id">@course.Name</option>
                }
            } *@
        </select>
    </div>
    <br />
    <center><input type="submit" value="Add" class="btn btn-primary" /></center>
</form>
<br />

<a class="btn btn-dark my-5 " style="width:100px" href="/Instructor/Index">Back</a>

<script src="~/lib/jquery/dist/jquery.min.js"></script>

<script>
    function GetCrs() {
        let val = document.getElementById("DepartmentId").value;
        let selectedCourseId = $("#CourseId").val();
        if (val != 0) {
            $.ajax({
                url: `/Instructor/CrsInDeps/${val}`,
                success: function (result) {
                    var courseSelect = document.getElementById("CourseId");
                    courseSelect.innerHTML = "";
                    for (let crs of result) {
                        let option = document.createElement("option");
                        option.value = crs.id; 
                        option.text = crs.name;
                        courseSelect.appendChild(option);
                    }
                    if ($("#CourseId option[value='" + selectedCourseId + "']").length > 0) {
                        $("#CourseId").val(selectedCourseId);
                    }
                }
            });
        }
    }
</script>